<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ app_name }} - Drosophila Stock Management System">
    <title>{% block title %}{{ title }} | {{ app_name }}{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/icons/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16.png">

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Custom styles -->
    <link rel="stylesheet" href="/static/css/main.css">

    {% block head %}{% endblock %}
</head>
<body class="h-full bg-gray-50" x-data="{ sidebarOpen: false }">
    {% block body %}
    <div class="min-h-screen flex flex-col">
        {% if current_user %}
        <!-- Navigation -->
        {% include "components/navbar.html" %}

        <div class="flex flex-1">
            <!-- Sidebar -->
            {% include "components/sidebar.html" %}

            <!-- Main content -->
            <main class="flex-1 lg:pl-56">
                <div class="py-6">
                    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                        <!-- Flash messages (passed from route) -->
                        {% if messages %}
                            {% for message in messages %}
                                <div class="mb-4 rounded-md p-4 {% if message.type == 'error' %}bg-red-50 text-red-700{% elif message.type == 'success' %}bg-green-50 text-green-700{% else %}bg-blue-50 text-blue-700{% endif %}">
                                    {{ message.text }}
                                </div>
                            {% endfor %}
                        {% endif %}

                        {% block content %}{% endblock %}
                    </div>
                </div>
            </main>
        </div>
        {% else %}
        <!-- Public layout (login, register) -->
        <main class="flex-1 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
            {% block public_content %}{% endblock %}
        </main>
        {% endif %}

        <!-- Footer -->
        <footer class="{% if current_user %}lg:pl-56{% endif %}">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-4 border-t border-gray-200">
                <p class="text-center text-xs text-gray-400">
                    {{ app_name }} v{{ app_version }}
                    &middot; by <a href="mailto:giorgio@gilest.ro" class="hover:text-gray-600">giorgio@gilest.ro</a>
                    &middot; powered by {{ app_llm_model }}
                </p>
            </div>
        </footer>
    </div>
    {% endblock %}

    <!-- Custom scripts -->
    <script src="/static/js/app.js"></script>

    <!-- Service Worker registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('SW registered'))
                .catch(err => console.log('SW registration failed:', err));
        }
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
